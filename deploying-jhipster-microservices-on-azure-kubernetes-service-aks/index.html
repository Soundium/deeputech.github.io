<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="icon" href="/assets/images/logo.png">

    <title>Deploying JHipster Microservices on Azure Kubernetes Service (AKS) | Technorage</title>

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Deploying JHipster Microservices on Azure Kubernetes Service (AKS) | Technorage</title>
<meta name="generator" content="Jekyll v2.0.0" />
<meta property="og:title" content="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)" />
<meta name="author" content="deepu" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)" />
<meta property="og:description" content="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)" />
<meta property="og:site_name" content="Technorage" />
<meta property="og:image" content="https://thepracticaldev.s3.amazonaws.com/i/zvmxe2mqyft5qa6vajgd.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-23T00:00:00+02:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"deepu"},"description":"Deploying JHipster Microservices on Azure Kubernetes Service (AKS)","@type":"BlogPosting","headline":"Deploying JHipster Microservices on Azure Kubernetes Service (AKS)","dateModified":"2019-06-23T00:00:00+02:00","datePublished":"2019-06-23T00:00:00+02:00","url":"https://medium.com/jhipster/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-fb46991746ba","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logo.png"},"name":"deepu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://medium.com/jhipster/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-fb46991746ba"},"image":"https://thepracticaldev.s3.amazonaws.com/i/zvmxe2mqyft5qa6vajgd.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        
    <link href="/assets/css/screen.css" rel="stylesheet">

    <link href="/assets/css/main.css" rel="stylesheet">

    <script src="/assets/js/jquery.min.js"></script>

</head>




<body class="layout-post">
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css" crossorigin="anonymous">
	</noscript>


<!-- Begin Menu Navigation
================================================== -->
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down pr-md-0 pl-md-0">

    <div class="container">

    <!-- Begin Logo -->
    <a class="navbar-brand" href="/">
        <h2>Deepu K Sasidharan</h2>
    </a>
    <!-- End Logo -->

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">

        <!-- Begin Menu -->

            <ul class="navbar-nav ml-auto">

                
                <li class="nav-item">
                
                    <a class="nav-link" href="/">About</a>
                </li>
            
                
                <li class="nav-item active">
                
                    <a class="nav-link" href="/blogs/"><i class="fas fa-blog"></i> Blog</a>
                </li>

                <li class="nav-item">
                    <a target="_blank" class="nav-link" href="https://www.packtpub.com/eu/application-development/full-stack-development-jhipster"><i class="fas fa-book"></i> Book</a>
                </li>

                <li class="nav-item">
                    <a target="_blank" class="nav-link" href="https://www.youtube.com/playlist?list=PLxayiD7e52nPpb-sSaoOPc-zXGhmOaNHK"><i class="fab fa-youtube"></i> Videos</a>
                </li>

                <li class="nav-item">
                    <a target="_blank" class="nav-link" href="https://speakerdeck.com/deepu105"><i class="fab fa-speaker-deck"></i> Presentations</a>
                </li>

                <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>

            </ul>

        <!-- End Menu -->

    </div>

    </div>
</nav>
<!-- End Navigation
================================================== -->

<div class="site-content">

<div class="container">

<!-- Content
================================================== -->
<div class="main-content">
    <!-- Site Title
================================================== -->
<div class="mainheading">
    <h1 class="sitetitle">Technorage</h1>
    <p class="lead">
        Where I rage about technology and stuff!
    </p>
</div>
<!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=Deploying JHipster Microservices on Azure Kubernetes Service (AKS)&url=/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                <div class="row post-top-meta">
                    <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                        
                        <img class="author-thumb" src="https://www.gravatar.com/avatar/7f408bc67dc9ae3b288ee92d16d3c4c2?s=250&d=mm&r=x" alt="Deepu K Sasidharan">
                        
                    </div>
                    <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                        <a target="_blank" class="link-dark" href="https://www.deepu.tech">Deepu K Sasidharan</a><a target="_blank" href="https://twitter.com/deepu105" class="btn follow">Follow</a>
                        <span class="author-description">JHipster co-lead, Java, JS, Cloud Native Advocate, Dev @ XebiaLabs, Author, Speaker, Software craftsman. Loves simple & beautiful code. bit.ly/JHIPSTER-BOOK</span>
                    </div>
                </div>
                

                <!-- Post Title -->
                <h1 class="posttitle">Deploying JHipster Microservices on Azure Kubernetes Service (AKS)</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid lazyimg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="https://thepracticaldev.s3.amazonaws.com/i/zvmxe2mqyft5qa6vajgd.png" alt="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                <!-- End Toc -->
                <p>If you are developing and deploying applications to production, especially cloud, you would have heard about <a href="https://kubernetes.io/"><strong>Kubernetes</strong></a>. Kubernetes(<strong>k8s</strong>) is a container orchestration platform originally developed by Google and makes deploying containerized/dockerized applications to production more manageable and scalable.</p>

<p><a href="https://kubernetes.io/"><strong>Kubernetes</strong></a> has been crowned as the undeniable champion of container orchestration for a while now and every other <strong>K*S</strong> offering that we see sprouting up are testimonials for that. The <strong>K</strong> obviously stands for Kubernetes and <strong>S/E</strong> stands for Service/Engine and the first letter stands for the product offering it. So far we have <a href="https://docs.microsoft.com/en-us/azure/aks/"><strong>AKS</strong></a>(Azure), <a href="https://cloud.google.com/kubernetes-engine/"><strong>GKE</strong></a>(Google), and <a href="https://aws.amazon.com/eks/"><strong>EKS</strong></a>(Amazon ECS) and <a href="https://content.pivotal.io/pivotal-container-service-pks"><strong>PKS</strong></a>(Pivotal) and also some flavors from <a href="https://cloud.oracle.com/en_US/containers/kubernetes-engine#">Oracle</a> and RedHat(read <a href="https://www.redhat.com/en/technologies/cloud-computing/openshift">Openshift</a>)</p>

<p>One of my colleagues have written a <a href="https://blog.xebialabs.com/2017/12/12/future-container-solutions-will-k-shaped/">nice article</a> about it, I highly recommend you read it as well.</p>

<p>In this article, we will see how we can deploy a microservice architecture created by JHipster to Azure Kubernetes Service.</p>

<p>Azure Kubernetes Service(AKS) is the managed Kubernetes platform offering from Microsoft to host your containerized applications.</p>

<h3 id="creating-the-microservice-application">Creating the microservice application</h3>

<p>In one of my <a href="https://dev.to/deepu105/create-full-microservice-stack-using-jhipster-domain-language-under-30-minutes-4ele">previous posts</a>, I showcased how to create a full stack microservice architecture using <strong>JHipster</strong> and <strong>JDL</strong>, read the post <a href="https://dev.to/deepu105/create-full-microservice-stack-using-jhipster-domain-language-under-30-minutes-4ele">here</a> if you want to learn more details about it. For this exercise, we will use the same application.</p>

<p>Let us recap the steps required.</p>

<p>Create a JDL file, let’s say app.jdl, and copy the below content into it.</p>

<noscript><pre>    application {
      config {
        baseName store,
        applicationType gateway,
        packageName com.jhipster.demo.store,
        serviceDiscoveryType eureka,
        authenticationType jwt,
        prodDatabaseType mysql,
        cacheProvider hazelcast,
        buildTool gradle,
        clientFramework react,
        testFrameworks [protractor]
      }
      entities *
    }

    application {
      config {
        baseName invoice,
        applicationType microservice,
        packageName com.jhipster.demo.invoice,
        serviceDiscoveryType eureka,
        authenticationType jwt,
        prodDatabaseType mysql,
        buildTool gradle,
        serverPort 8081
      }
      entities Invoice, Shipment
    }

    application {
      config {
        baseName notification,
        applicationType microservice,
        packageName com.jhipster.demo.notification,
        serviceDiscoveryType eureka,
        authenticationType jwt,
        databaseType mongodb,
        cacheProvider no,
        enableHibernateCache false,
        buildTool gradle,
        serverPort 8082
      }
      entities Notification
    }

    /* Entities for Store Gateway */

    /** Product sold by the Online store */
    entity Product {
        name String required
        description String
        price BigDecimal required min(0)
        size Size required
        image ImageBlob
    }

    enum Size {
        S, M, L, XL, XXL
    }

    entity ProductCategory {
        name String required
        description String
    }

    entity Customer {
        firstName String required
        lastName String required
        gender Gender required
        email String required pattern(/^[^@\s]+@[^@\s]+\.[^@\s]+$/)
        phone String required
        addressLine1 String required
        addressLine2 String
        city String required
        country String required
    }

    enum Gender {
        MALE, FEMALE, OTHER
    }

    entity ProductOrder {
        placedDate Instant required
        status OrderStatus required
        code String required
        invoiceId Long
    }

    enum OrderStatus {
        COMPLETED, PENDING, CANCELLED
    }

    entity OrderItem {
        quantity Integer required min(0)
        totalPrice BigDecimal required min(0)
        status OrderItemStatus required
    }

    enum OrderItemStatus {
        AVAILABLE, OUT_OF_STOCK, BACK_ORDER
    }

    relationship OneToOne {
        Customer{user(login) required} to User
    }

    relationship ManyToOne {
     OrderItem{product(name) required} to Product
    }

    relationship OneToMany {
       Customer{order} to ProductOrder{customer(email) required},
       ProductOrder{orderItem} to OrderItem{order(code) required} ,
       ProductCategory{product} to Product{productCategory(name)}
    }

    service Product, ProductCategory, Customer, ProductOrder, OrderItem with serviceClass
    paginate Product, Customer, ProductOrder, OrderItem with pagination

    /* Entities for Invoice microservice */
    entity Invoice {
        code String required
        date Instant required
        details String
        status InvoiceStatus required
        paymentMethod PaymentMethod required
        paymentDate Instant required
        paymentAmount BigDecimal required
    }

    enum InvoiceStatus {
        PAID, ISSUED, CANCELLED
    }

    entity Shipment {
        trackingCode String
        date Instant required
        details String
    }

    enum PaymentMethod {
        CREDIT_CARD, CASH_ON_DELIVERY, PAYPAL
    }

    relationship OneToMany {
        Invoice{shipment} to Shipment{invoice(code) required}
    }

    service Invoice, Shipment with serviceClass
    paginate Invoice, Shipment with pagination
    microservice Invoice, Shipment with invoice

    /* Entities for notification microservice */

    entity Notification {
        date Instant required
        details String
        sentDate Instant required
        format NotificationType required
        userId Long required
        productId Long required
    }

    enum NotificationType {
        EMAIL, SMS, PARCEL
    }

    microservice Notification with notification</pre></noscript>
<script src="https://gist.github.com/https://gist.github.com/deepu105/127b220d0c7a3bbf06386cef8128d2f5.js"> </script>

<p>Now create a directory called <strong>ecommerce</strong> and navigate into it. Run the JHipster import-jdl command. It could take a few minutes, especially the NPM install step.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>$ mkdir ecommerce &amp;&amp; cd ecommerce
$ jhipster import-jdl app.jdl
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Once the JHipster process is complete, you will see that we have our store gateway, invoice service and notification service created and ready for us. The process until this is explained in more detail in my previous post <a href="https://dev.to/deepu105/create-full-microservice-stack-using-jhipster-domain-language-under-30-minutes-4ele">here</a> and you can deploy the application locally using Docker as explained in that post. If you haven’t done that before I strongly suggest that step so that you get an idea of the application and you also can make sure it works locally on your machine.</p>

<h3 id="generating-the-kubernetes-configuration">Generating the Kubernetes configuration</h3>

<p>Now that our application is ready, let us create the required configurations for Kubernetes using JHipster. This can also be done using JDL by adding below snippet to the JDL file we used earlier.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>deployment {
  deploymentType kubernetes
  appsFolders [store, invoice, notification]
  serviceDiscoveryType eureka
  dockerRepositoryName "deepu105" // use your own docker repo username here
  kubernetesNamespace jhipster
  kubernetesServiceType LoadBalancer
  monitoring no
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For now, let us use the JHipster CLI to do this. In the ecommerce folder, we created earlier, create a new directory, let’s call in k8s so that we get the below structure.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>├── app.jdl
├── invoice
├── kubernetes
├── notification
└── store
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Create the kubernetes directory and navigate to it. Now run the JHipster Kubernetes command there.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>$ mkdir kubernetes &amp;&amp; cd kubernetes
$ jhipster kubernetes
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The generator will ask you a few questions and choose the answers as highlighted below, as you can see the questions are very similar to the ones asked by jhipster docker-compose command. For the “base Docker repository name” provide your own docker hub account id(For example, my Docker Hub id is <a href="https://hub.docker.com/u/deepu105/">deepu105</a>). For real-world use cases, you could also use a private image repository like the <a href="https://docs.microsoft.com/en-us/azure/aks/tutorial-kubernetes-prepare-acr">Azure Container Registry</a> and in that case, you would have to provide the ACR login server name here. For now, let us keep it simple.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre>⎈ Welcome to the JHipster Kubernetes Generator ⎈
Files will be generated in folder: /home/deepu/workspace/temp/ecommerce/kubernetes
✔ Docker is installed

? Which *type* of application would you like to deploy? Microservice application

? Enter the root directory where your gateway(s) and microservices are located ../

3 applications found at /home/deepu/workspace/temp/ecommerce/
? Which applications do you want to include in your configuration? invoice, notification, store

? Do you want to setup monitoring for your applications ? No

? Which applications do you want to use with clustered databases (only available with MongoDB and Couchbase)? 

JHipster registry detected as the service discovery and configuration provider used by your apps

? Enter the admin password used to secure the JHipster Registry admin

? What should we use for the Kubernetes namespace? jhipster

? What should we use for the base Docker repository name? &lt;your Docker hub account id&gt;

? What command should we use for push Docker image to repository? docker push

? Do you want to enable Istio? No

? Choose the kubernetes service type for your edge services LoadBalancer - Let a kubernetes cloud provider automatically assign an IP
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The generator will go to work with this and will create the following files and output.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre>   create invoice/invoice-deployment.yml
   create invoice/invoice-service.yml
   create invoice/invoice-mysql.yml
   create notification/notification-deployment.yml
   create notification/notification-service.yml
   create notification/notification-mongodb.yml
   create store/store-deployment.yml
   create store/store-service.yml
   create store/store-mysql.yml
   create README.md
   create registry/jhipster-registry.yml
   create registry/application-configmap.yml
   create kubectl-apply.sh

WARNING! Kubernetes configuration generated with missing images!

To generate the missing Docker image(s), please run:

  ./gradlew -Pprod bootWar jibDockerBuild in /home/deepu/workspace/temp/ecommerce/invoice

  ./gradlew -Pprod bootWar jibDockerBuild in /home/deepu/workspace/temp/ecommerce/notification

  ./gradlew -Pprod bootWar jibDockerBuild in /home/deepu/workspace/temp/ecommerce/store

WARNING! You will need to push your image to a registry. If you have not done so, use the following commands to tag and push the images:

  docker image tag invoice deepu105/invoice
  docker push deepu105/invoice

  docker image tag notification deepu105/notification
  docker push deepu105/notification

  docker image tag store deepu105/store
  docker push deepu105/store

You can deploy all your apps by running the following script:
  ./kubectl-apply.sh

Use these commands to find your application's IP addresses:
  kubectl get svc store

Congratulations, JHipster execution is complete!
</pre></td></tr></tbody></table></code></pre></div></div>

<p>As you can see the generator creates all the required Kubernetes configuration files and prints out useful information to proceed further (Note that the docker hub id you provided will be in the instructions in place of <strong>deepu105</strong> here). Go through the generated k8s files and familiarize yourself.</p>

<p>Now we are ready.</p>

<p>Let us build and push the docker images for our application. Follow the instructions above and build docker images in each of the application folders and then tag and push the images to your Docker hub account.</p>

<h3 id="preparing-aks-cluster">Preparing AKS Cluster</h3>

<p>Now that our applications are built and pushed its time for us to deploy them to AKS. But before that let’s make sure we have all the prerequisites ready. You will need the below tools.</p>

<ol>
  <li>
    <p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a>: The command line tool to interact with Kubernetes. Install and configure it.</p>
  </li>
  <li>
    <p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI</a>: The command line tool to interact with Azure. Install and log in with your Azure account(You can create a <a href="https://azure.microsoft.com/en-us/free/">free account</a> if you don’t have one already).</p>
  </li>
</ol>

<p>Once the tools are ready let us prepare our Kubernetes cluster.</p>

<p>First, let us create a resource group. Run the below command. This will create a resource group named <strong>eCommerceCluster</strong> in US east location(You can use other <a href="https://azure.microsoft.com/en-us/global-infrastructure/regions/">Azure regions</a> as well).</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ az group create --name eCommerceCluster --location eastus
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now let us create an AKS cluster on the resource group we just created. Run the below command to create a cluster named eCommerceCluster with two nodes(We would need some room to run all those containers). It also enables the Azure monitor on the cluster through the add-on specified.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>$ az aks create --resource-group eCommerceCluster \
--name eCommerceCluster --node-count 2 \
--enable-addons monitoring --generate-ssh-keys
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This would take several minutes to complete hence be patient and have a coffee :)</p>

<p>Did I emphasize on <strong>several minutes</strong>?</p>

<p>Once it’s done you should see the cluster information printed out as JSON.</p>

<p>Now, let us configure <strong>kubectl</strong> to connect to the AKS cluster we just created. This can be done automatically using the Azure CLI by running the below handy command.</p>

<p>Note: Some Azure CLI commands might take a while to execute, especially if you are on a slow network, sometimes if the below commands seem stalled or if it is timed out, kill it and retry again.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ az aks get-credentials --resource-group eCommerceCluster --name eCommerceCluster
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Verify that we are able to connect to the cluster by running kubectl get nodes</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>$ kubectl get nodes
NAME                       STATUS    ROLES     AGE       VERSION
aks-nodepool1-34429729-0   Ready     agent     22m       v1.9.9
aks-nodepool1-34429729-1   Ready     agent     22m       v1.9.9
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="deploying-the-application-to-aks">Deploying the application to AKS</h3>

<p>Now that our cluster is ready, let us deploy our microservice stack to this cluster.</p>

<p>We can deploy our application using the kubectl apply command for this we have to navigate to the k8s folder we created earlier and run the below commands in the same order</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>$ kubectl apply -f registry

$ kubectl apply -f invoice

$ kubectl apply -f notification

$ kubectl apply -f store
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Or you could also just run the handy <code class="highlighter-rouge">kubectl-apply.sh</code> script generated which runs the above.</p>

<p>So we are deploying the JHipster Registry first as it is required for other services, followed by the microservices and finally our gateway(store).</p>

<p>If you get a timeout during any of these, as I did, just try the command again.</p>

<p>Though the services get created fast, the actual applications might not be up and running yet, give the entire thing a minute or two to start.</p>

<p>Now run kubectl get pods to see the status of our containers.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>$ kubectl get pods -w

NAME                                    READY  STATUS 
invoice-5ffb46d944-h8x42                1/1    Running
invoice-mysql-66bc4b7874-p7ghk          1/1    Running
jhipster-registry-0                     1/1    Running
jhipster-registry-1                     1/1    Running
notification-76847b7667-d7xjb           1/1    Running
notification-mongodb-6db986b556-8bw8z   1/1    Running
store-8dc5cd6f7-s2dpx                   1/1    Running
store-mysql-779d66685d-tmkqd            1/1    Running
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Note: I have removed some info for brevity in the above output.</p>

<p>Wait until all the containers are in <strong>Running</strong> status. Once the containers are running we can run the kubectl get service command to get the external IP for the application.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>$ kubectl get service store

NAME   TYPE         CLUSTER-IP    EXTERNAL-IP    PORT(S)         AGE
store  LoadBalancer 10.0.189.145  40.117.140.228 8080:30143/TCP  18m
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In this case, the external IP for our gateway application is <strong>40.117.140.228</strong> running on port <strong>8080</strong>. Let us open it up in a web browser.</p>

<p><img src="https://cdn-images-1.medium.com/max/2624/1*OQSuDw4u-CHGdkl0VR_DIw.png" alt="The Gateway application login page" /><em>The Gateway application login page</em></p>

<p>The JHipster registry is deployed as a headless service by default. If we need to access the registry we need to create a secondary service with a Load Balancer. Run the below command to expose the second service.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ kubectl expose service jhipster-registry --type=LoadBalancer --name=exposed-registry
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now run the kubectl get service command to get the IP.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>$ kubectl get service exposed-registry

NAME             TYPE         CLUSTER-IP   EXTERNAL-IP    PORT(S)
exposed-registry LoadBalancer 10.0.107.121 104.211.15.142 8761:32628/TCP
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Visit the URL in a browser to see the registry in action</p>

<p><img src="https://cdn-images-1.medium.com/max/2978/1*tWbLvvpXCF9kHPmEadyMKQ.png" alt="JHipster Registry home page" /><em>JHipster Registry home page</em></p>

<p>We can now scale any of our services by simply running kubectl scale command. For example, let us scale our Invoice service.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ kubectl scale --replicas=2 deployment/invoice
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Now we can visit the <strong>Eureka -&gt; Instances</strong> on our Registry and see that the Invoice service has two instances.</p>

<p><img src="https://cdn-images-1.medium.com/max/2596/1*YGhPu44fNsApmKZYXQAaqQ.png" alt="JHipster Registry instances page" /><em>JHipster Registry instances page</em></p>

<p>Running kubectl get pods will also show you the new instance.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>$ kubectl get pods
 
NAME                                  READY  STATUS   AGE
invoice-5ffb46d944-g8j6j              1/1    Running  4m
invoice-5ffb46d944-h8x42              1/1    Running  2h
invoice-mysql-66bc4b7874-p7ghk        1/1    Running  2h
jhipster-registry-0                   1/1    Running  2h
jhipster-registry-1                   1/1    Running  2h
notification-76847b7667-d7xjb         1/1    Running  2h
notification-mongodb-6db986b556-8bw8z 1/1    Running  2h
store-8dc5cd6f7-s2dpx                 1/1    Running  2h
store-mysql-779d66685d-tmkqd          1/1    Running  2h
</pre></td></tr></tbody></table></code></pre></div></div>

<p>That is it, we have successfully got our application deployed to AKS and scaled our service on demand.</p>

<h3 id="cleanup">Cleanup</h3>

<p>Once you are done its always a good idea to clean up especially since we don’t want to keep unnecessary resources that might eat up our free credits on Azure.</p>

<p>Let us delete the cluster from AKS and related resources created by deleting the entire resource group.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ az group delete --name eCommerceCluster --yes --no-wait
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Cluster related activities like creation/update/deletion could take several minutes on AKS so we have to be patient again here.</p>

<h3 id="conclusion">Conclusion</h3>

<p>Kubernetes is definitely the best way to deploy microservice applications to production but creating and managing Kubernetes clusters itself is not an easy task, but Kubernetes services like <strong>GKE</strong> and <strong>AKS</strong> makes it a cakewalk. In my personal experience, the Kubernetes service from Google(GKE) and Azure(AKS) are by far the best in terms of ease of use and available tooling. These services provide very handy command line tools which work nicely together with <strong>kubectl</strong> to provide a very nice experience. They also have nice UI portals if you are not a fan of the CLI.</p>

<p>JHipster provides a great Kubernetes setup to start with which you can further tweak as per your needs and platform.</p>

<p>In upcoming posts, we will look at more services like GKE(Google), EKS(Amazon) and Openshift(RedHat)</p>

<p>To learn more about JHipster, check out my book “<em>Full Stack Development with JHipster</em>” on <a href="https://www.amazon.com/Stack-Development-JHipster-Deepu-Sasidharan/dp/178847631X">Amazon</a> and <a href="https://www.packtpub.com/application-development/full-stack-development-jhipster">Packt</a>.</p>

<p>If you like JHipster don’t forget to give it a star on <a href="https://github.com/jhipster/generator-jhipster">Github</a>.</p>

<p>If you like this article, please leave a like or a comment.</p>

<p>You can follow me on <a href="https://twitter.com/deepu105">Twitter</a> and <a href="https://www.linkedin.com/in/deepu05/">LinkedIn</a>.</p>

<p>My other related posts:</p>

<ol>
  <li>
    <p><a href="https://dev.to/deepu105/create-full-microservice-stack-using-jhipster-domain-language-under-30-minutes-4ele">Create full Microservice stack using JHipster Domain Language under 30 minutes</a></p>
  </li>
  <li>
    <p><a href="https://medium.com/@deepu105/jhipster-microservices-with-istio-service-mesh-on-kubernetes-a7d0158ba9a3">JHipster microservices with Istio service mesh on Kubernetes</a></p>
  </li>
</ol>

<p>Originally published in <a href="https://medium.com/jhipster/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-fb46991746ba">Medium</a> on Oct 01, 2018</p>

            </div>

            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2019-06-23">23 Jun 2019</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/tags#azure,">#azure,</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#jhipster,">#jhipster,</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#kubernetes,">#kubernetes,</a>
                    </li>
                    
                    <li>
                        <a class="smoothscroll" href="/tags#microservices">#microservices</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="/my-beautiful-linux-development-environment/"> &laquo; My beautiful Linux development environment</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="/must-have-gnome-plugins/">Must have GNOME extensions &raquo; </a>
            
            <div class="clearfix"></div>
            </div>
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->

    <div class="container">
        <div id="comments" class="row justify-content-center mb-5">
            <div class="col-md-8">
                <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'deepu-tech'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

            </div>
        </div>
    </div>

<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>


    
</div>

<!-- Categories Jumbotron
================================================== -->
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
            <div class="d-md-flex align-items-center justify-content-center h-100">
                <h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
            </div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
            
            
                
                    <a class="mt-1 mb-1" href="/tags#jhipster,">jhipster, (3)</a>
                
                    <a class="mt-1 mb-1" href="/tags#java,">java, (2)</a>
                
                    <a class="mt-1 mb-1" href="/tags#microservices,">microservices, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#docker">docker (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#azure,">azure, (2)</a>
                
                    <a class="mt-1 mb-1" href="/tags#terraform">terraform (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#writing,">writing, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#medium,">medium, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#development,">development, (2)</a>
                
                    <a class="mt-1 mb-1" href="/tags#tech">tech (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#linux,">linux, (3)</a>
                
                    <a class="mt-1 mb-1" href="/tags#fedora,">fedora, (2)</a>
                
                    <a class="mt-1 mb-1" href="/tags#gnome">gnome (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#kubernetes,">kubernetes, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#microservices">microservices (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#gnome,">gnome, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#desktop">desktop (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#terminal,">terminal, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#oh-my-zsh,">oh-my-zsh, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#zsh">zsh (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#go,">go, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#programming,">programming, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#languages,">languages, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#thepragmaticprogrammer">thepragmaticprogrammer (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#typescript,">typescript, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#react,">react, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#javascript,">javascript, (1)</a>
                
                    <a class="mt-1 mb-1" href="/tags#webdev">webdev (1)</a>
                
            
            
		</div>
	</div>
</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                Copyright © 2019 Deepu K Sasidharan 
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net |
                Domain by 
                <a href="https://js.org" target="_blank" title="JS.ORG | JavaScript Community">
                    <img src="https://logo.js.org/dark_tiny.png" style="width:50px" alt="JS.ORG Logo">
                </a> | 
                Hosted with <i class="far fa-heart"></i> by <a href="https://pages.github.com/" target="_blank">Github</a>
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts
================================================== -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

<script src="/assets/js/mediumish.js"></script>


<script src="/assets/js/lazyload.js"></script>


<script src="/assets/js/ie10-viewport-bug-workaround.js"></script> 


<script id="dsq-count-scr" src="//deepu-tech.disqus.com/count.js"></script>


</body>
</html>
